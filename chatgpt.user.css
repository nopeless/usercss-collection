/* ==UserStyle==
@name           ChatGPT Frosted Glass UI - nopeless
@namespace      github.com/nopeless/usercss-collection/chatgpt.user.css
@version        1.10.3
@description    rosted Glass UI overhaul that enhances ChatGPT UI by nopeless. Custom backgrounds and accent color supported with many more configurable options
@author         nopeless
@updateURL      https://github.com/nopeless/usercss-collection/raw/refs/heads/main/chatgpt.user.css
@preprocessor uso

@var select background-image-fallback    "BG - Preset" {
 "Your Name sky": "url(https://r4.wallpaperflare.com/wallpaper/94/797/206/kimi-no-na-wa-makoto-shinkai-starry-night-comet-wallpaper-89c0584d016a0d0be617288fb071564d.jpg)",
 "Your Name space": "url(https://images2.alphacoders.com/742/thumb-1920-742320.png)",
 "Re-Zero": "url(https://images4.alphacoders.com/711/711904.png)",
 "Madoka": "url(https://images2.alphacoders.com/784/thumb-1920-784533.jpg)",
 "Frieren (space)": "url(https://images3.alphacoders.com/137/thumb-1920-1376375.png)",
 "Frieren (magic)": "url(https://images6.alphacoders.com/135/thumb-1920-1355194.jpeg)",
 "Stranded Valley": "url(https://i.redd.it/smjx0oc21w0e1.png)",
 "Space": "url(https://images8.alphacoders.com/137/thumb-1920-1370824.png)",
 "Aqua Eterna": "url(https://www.desktopgeneration.com/images/art/gallery/aquaeterna.png)",
 "No Game No Life": "url(https://picfiles.alphacoders.com/439/thumb-1920-439700.png)",
 "MuseDash Maria": "url(https://images.steamusercontent.com/ugc/2471994135749408790/79FFA5F097AB73974B94DBACBEF4CC39F6586C5A/)",
 "Minecraft Dungeons": "url(https://i0.wp.com/xboxera.com/wp-content/uploads/2020/04/Minecraft_Dungeons_Intro_Cinematic_Heroes_Gathering.png?w=3840&ssl=1)",
 "Black": "black",
 "Gray": "gray",
 "White": "white",
 "Navy": "#303655",
 "Pastel": "linear-gradient(-45deg, #ffb3ba, #ffdfba, #ffffba, #baffc9, #bae1ff, #d7baff)",
 "Classic": "linear-gradient(45deg,#1e1e2e,#181825,#11111b,#313244,#45475a)",
 "Default": "#3A3A3A"
}
@var text uso-background-image    "BG - Custom image url"  ""
@var range background-align-x     "BG - Align horizontal"  [50, 0, 100, 5, "%"]
@var range background-align-y     "BG - Align vertical"    [50, 0, 100, 5, "%"]
@var range dim-top                "BG - Dim top"           [50, 0, 100, 5, "%"]
@var range dim-bottom             "BG - Dim bottom"        [50, 0, 100, 5, "%"]

@var range glass-blur             "UI - Blur strength"         [2,  0, 10,  1, "px"]
@var range backdrop-brightness    "UI - Popup transparency"    [70, 0, 100, 5, "%"]
@var color accent-color           "UI - Accent color (light)"  "#FFFFFF"

@var text sidebar-active-bullet   "Sidebar - Selected chat icon"  "'â€¢'"

@var text bottom-container-text   "Prompt - Text below"     "'You are loved <3'"
@var text chat-input-placeholder  "Prompt - Placeholder"    "'ask away!'"
@var range chat-input-radius      "Prompt - Border radius"  [28, 0, 28, 4, "px"]
@var select chat-input-box-shadow "Prompt - Border style" {
  "All": "rgba(0, 0, 0, 0.1) 0px 4px 12px 0px, rgba(255, 255, 255, 0.3) 0px 0px 1px 0px inset",
  "Only top": "rgba(0, 0, 0, 0.1) 0px -12px 12px -12px, rgba(255, 255, 255, 0.3) 0px 2px 1px -2px inset"
}
@var select chat-input-max-width  "Prompt - Width" {
  "Align with chat": "calc(min(var(--chat-max-width), 100%) - 2 * var(--chat-padding-x))",
  "Full": "none"
}

@var select uso-css-text-shadow   "Chat - Text shadow" {
  "none": "",
  "fast": "text-shadow: 1px 1px 0 black",
  "light": "text-shadow: 0 0 7px black;",
  "medium": "text-shadow: 0 0 7px black, 0 0 7px black;",
  "heavy": "text-shadow: 2px 0 10px black, -2px 0 10px black, 0 2px 10px black, 0 -2px 10px black;"
}
@var range chat-padding-x         "Chat - Horizontal margins"  [3,  0, 5,  0.5, "rem"]
@var range chat-max-width         "Chat - Max width"           [100,  50, 200,  10, "rem"]
@var range reading-max-width      "Chat - Paragraph width"     [50,  10, 100,  5, "rem"]

@var range chat-role-padding      "Message - Left/Right margin"  [4, 0, 10, 1, "rem"]

@var color code-background-color  "Code - Background color"      "#10101040"
@var select codeblock-width       "Code - Overflow" {
  "Wrap": "100%",
  "Scroll": "max-content"
}
@var select codeblock-min-width    "Code - Fit mode" {
  "Compact": "calc(var(--spacing) * 8 * 6)",
  "Paragraph": "var(--reading-max-width)",
  "Full": "100%"
}
@var select math-min-width         "Math - Fit mode" {
  "Compact left align": "calc(var(--spacing) * 8 * 6)",
  "Paragraph": "var(--reading-max-width)",
  "Full": "100%"
}
==/UserStyle== */

@-moz-document domain("chatgpt.com") {
/* uso section */
:root {
--background-image: url("/*[[uso-background-image]]*/");
--background-image-fallback: /*[[background-image-fallback]]*/;
--background-align-x: /*[[background-align-x]]*/;
--background-align-y: /*[[background-align-y]]*/;
--dim-top: /*[[dim-top]]*/;
--dim-bottom: /*[[dim-bottom]]*/;
--glass-blur: /*[[glass-blur]]*/;
--backdrop-brightness: /*[[backdrop-brightness]]*/;
--accent-color: /*[[accent-color]]*/;
--sidebar-active-bullet: /*[[sidebar-active-bullet]]*/;
--bottom-container-text: /*[[bottom-container-text]]*/;
--chat-input-placeholder: /*[[chat-input-placeholder]]*/;
--chat-input-radius: /*[[chat-input-radius]]*/;
--chat-input-box-shadow: /*[[chat-input-box-shadow]]*/;
--chat-input-max-width: /*[[chat-input-max-width]]*/;
--chat-padding-x: /*[[chat-padding-x]]*/;
--chat-max-width: /*[[chat-max-width]]*/;
--chat-role-padding: /*[[chat-role-padding]]*/;
--reading-max-width: /*[[reading-max-width]]*/;
--code-background-color: /*[[code-background-color]]*/;
--codeblock-width: /*[[codeblock-width]]*/;
--codeblock-min-width: /*[[codeblock-min-width]]*/;
--math-min-width: /*[[math-min-width]]*/;
}

:root {
--blur-around-text: 2px;
/* derived properties */
--__backdrop-brightness-to-background: hsl(0,
0%,
0%,
calc(40% - (100% - var(--backdrop-brightness)) / 2));

}

/* override accent colors */
[data-chat-theme="default"],
[data-chat-theme="default"] .dark {
--theme-user-msg-bg: var(--accent-color);
--theme-submit-btn-bg: var(--accent-color);
--theme-secondary-btn-bg: var(--accent-color);
--theme-entity-accent: var(--accent-color);
--theme-user-selection-bg: color-mix(in srgb,
var(--accent-color),
#0000);
--theme-attribution-highlight-bg: color-mix(in srgb,
var(--accent-color),
#0000);

}

/* restore accent pill selection */
.h-2\.5.w-2\.5.rounded-full {
background: var(--theme-secondary-btn-bg);

}

/* === ACCENT MODIFICATIONS === */
@layer utilities {
  .bg-token-text-primary\! {
    background-color: var(--theme-submit-btn-bg);
  }

  /*   user message */
  .user-message-bubble-color {
    background-color: transparent;
  }
}

/*  === BACKGROUND === */
/* remove all background */
div,
aside,
button,
header,
span,
ul,
/* prompt input bottom fade */
.content-fade::after,
/* settings modal background */
div[data-testid="modal-settings"] > :first-child::before {
  background: transparent !important;
}

/* force remove a few backgrounds as they are !important by site */
@layer utilities {
  .dark\:bg-\[\#303030\]\!:is(.dark *) {
    background: transparent !important;
  }

  .composer-submit-button-color {
    color: inherit;
  }
}

/* XXX heuristics: check for existence of '-' in data-build */
/* equiv to if (uso-background-image === "") */
html[data-build*="-/*[[uso-background-image]]*/"] > body {
  --background-image: var(--background-image-fallback)
}

/* image background */
body {
  background: linear-gradient(rgba(0, 0, 0, var(--dim-top)),
  rgba(0, 0, 0, var(--dim-bottom))),
  var(--background-image) no-repeat calc(100% - var(--background-align-x)) var(--background-align-y)/cover !important;
}

/* === FROSTED GLASS EFFECT === */
/* Use tailwind backdrop system for other elements */
/* narrow mode overlap */
#stage-popover-sidebar,
/* search GPTs */
#search,
/* when selection ask chatgpt */
.btn.active\:opacity-1,
/* voice mode */
.fixed,
/* clicking account button */
[data-radix-popper-content-wrapper] > div:first-child,
/* modal settings */
[data-testid="modal-settings"] > div,
/* modal search chats */
[data-testid="modal-fanny-pack"] > div,
/* modal new project */
[data-testid="modal-new-project-enhanced"] > div,
/* sidebar selected */
.__menu-item[data-active],
/* popup "you've hit free plan limit" */
aside.shadow-xxs {
  backdrop-filter: blur(var(--glass-blur)) brightness(var(--backdrop-brightness));
  background: transparent;
}

.popover {
  background: var(--__backdrop-brightness-to-background);
}

/* this entire section is just for search GPTs */
@layer utilities {
  div:has( > div > #search:focus),
  #search:focus {
    border-bottom-color: transparent;
    border-bottom-left-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
  }

  #search {
    background: var(--__backdrop-brightness-to-background) !important;
  }

  [data-radix-popper-content-wrapper] > div:first-child {
    background: var(--__backdrop-brightness-to-background) !important;
    /*     account for border bottom */
    top: -1px !important;
  }
}

/* === SIDEBAR === */
.__menu-item[data-active]::before {
  content: var(--sidebar-active-bullet);
}

/* === CHAT VISUAL === */
/* implement chat-max-width */
#page-header + div > div:first-child > div:last-child > div:last-child {
  margin: 0 auto;
  width: 100%;
  max-width: var(--chat-max-width);
  padding-left: var(--chat-padding-x);
  padding-right: var(--chat-padding-x);
}

#thread-bottom > div:first-child {
  padding-left: 0;
  padding-right: 0;
  max-width: var(--chat-input-max-width);
}

#thread-bottom > div:first-child > div:first-child {
  max-width: none;
}

/* Change chat max width */
.group\/turn-messages {
  max-width: none;
}

/* ensure margins for small screens */
article[data-turn="user"] > div {
  padding-left: var(--chat-role-padding);
  padding-right: 0;
}

article[data-turn="assistant"] > div {
  padding-right: var(--chat-role-padding);
  padding-left: 0;
}

.user-message-bubble-color {
  padding: 5px;
}

/* === text shadow === */
.user-message-bubble-color,
.markdown,
#history {
  /*[[uso-css-text-shadow]]*/;
}
.__menu-item[data-active], code:not([class]) {
  text-shadow: none;
}

/* === text blur backdrop anchor for ::before === */
.user-message-bubble-color,
.markdown :is(p,
table,
.katex) {
  position: relative;
}

/* add blur to textual elements and surrounding */
.user-message-bubble-color::before,
.markdown :is(p)::before {
  position: absolute;
  content: "";
  inset: calc(-1 * var(--blur-around-text));
  border-radius: calc(2 * var(--blur-around-text));
  backdrop-filter: blur(var(--glass-blur));
  z-index: -1;
}

/* add non-overflowing blur to certain elements */
.markdown :is(table,
.katex)::before {
  position: absolute;
  content: "";
  inset: 0;
  backdrop-filter: blur(var(--glass-blur));
  z-index: -1;
}

/* header consistency fix when resizing */
#page-header,
div.h-header-height.sticky {
  position: absolute;
  width: 100%;
  backdrop-filter: blur(var(--glass-blur));
}

.thread-xl\:pt-header-height {
  padding-top: 0;
}

.thread-xl\:pt-\(--header-height\) {
  padding-top: var(--header-height);
}

/* fix x scrolling caused by surround blur and a few other random things */
#page-header + div > div:first-child > div:first-child {
  overflow-x: clip;
}

/* Change horizontal margins around chat*/
.text-base {
  padding-left: var(--chat-padding-x);
  padding-right: var(--chat-padding-x);
}

/* paragraph layout helpers */
.markdown :is(p,
hr),
markdown td,
.user-message-bubble-color {
  max-width: var(--reading-max-width);
}

/* TABLE REWRITE */
.markdown > div[class^="_tableContainer"] {
  width: auto;
  margin-inline: 0;
  overflow-x: auto;
}

.markdown > div[class^="_tableContainer"] > div {
  margin: 0;
}

.markdown > div[class^="_tableContainer"] > div > div.sticky {
  inset-inline-end: 0;
}

/* === MATH VISUAL === */
.katex-display {
  min-width: min(100%,
  var(--math-min-width));
  width: fit-content;
  max-width: 100%;

  scrollbar-color: var(--scrollbar-color) transparent;
  overflow-x: auto;
  overflow-y: clip;
/*   for reasons beyond my understanding, sometimes katex span elements overflow
  visually (not bb) and this is the only way to compensate for that */
  padding: 2px;
}

/* === CODEBLOCK VISUAL === */
/* code background color */
.markdown pre .bg-token-sidebar-surface-primary,
.markdown code:not([class]) {
  background: var(--code-background-color) !important;
}

/* allow layout calculations for code blocks */
.markdown pre > div {
  text-shadow: none;

  contain: none;
  backdrop-filter: blur(var(--glass-blur));
  min-width: min(100%,
  var(--codeblock-min-width));
  width: fit-content;
  max-width: 100%;
}

/* allow text to overflow */
.markdown pre > div:first-child > div:last-child > code {
  display: block;
  width: max-content;
  max-width: var(--codeblock-width);
}

/* increase right margin a bit for breathing room */
.markdown pre > div > div:last-child {
  padding: 0.75rem;
  padding-right: 2rem;
}

/* baseline is wrap */
.markdown pre span {
  text-wrap: wrap;
}

/* === CHAT INPUT BOX === */
/* chrome firefox disparity here */
.placeholder::after {
  content: none !important;
}

.placeholder::before {
  color: var(--text-tertiary);
  content: var(--chat-input-placeholder) !important;
}

/* chat input box radius */
form.group\/composer > div:last-child > div:first-child {
  border-radius: var(--chat-input-radius) !important;
  box-shadow: var(--chat-input-box-shadow);
}

/* remove margin fix chat content bleeding into chat input box */
.-mb-\(--composer-overlap-px\) {
  margin: 0;
}

/* change chatgpt can make mistakes message + style changes */
#thread-bottom-container > :last-child {
  padding: 0;
  min-height: 0;
}

#thread-bottom-container > :last-child > div {
  font-size: 0;
}

#thread-bottom-container > :last-child > div::before {
  font-size: 12px;
  display: block;
  text-align: center;
  line-height: 1.5rem;
  content: var(--bottom-container-text);
}

/* === UI Elements === */
/* switch circle, button */
button[aria-checked] > span,
button.btn-primary {
  background: var(--theme-entity-accent) !important;
}

button.btn-primary svg {
  color: black;
}

/* switch and button background */
button[aria-checked] {
  background: gray !important;
}

.group\/sidebar-expando-section {
  margin-bottom: 0;
}

/*   fix side panel scrolling overlap (this is the only fix) */
nav[aria-label="Chat history"] > :nth-last-child(1 of .group\/sidebar-expando-section) {
  overflow-y: hidden;
  display: flex;
  flex-direction: column;
}

#history {
  overflow-y: scroll;
  scrollbar-color: var(--scrollbar-color) transparent;
}

/* compact chat */
nav[aria-label="Chat history"] > :not(:last-child) {
  padding: 0;
}

/* new project padding bottom */
#snorlax-heading {
  padding-bottom: 0.5rem;
}

/* remove top padding for proper scrolling for Chats list */
#history > aside {
  padding-top: 0;
}
}
